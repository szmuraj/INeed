@using INeed.Data
@inject ApplicationDbContext _context

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - INeed</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <link rel="stylesheet" href="~/css/bootstrap_colors.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">

    @{
        string GetButtonColor(string controller, string action, string? id = null)
        {
            var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();
            var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
            var currentId = ViewContext.RouteData.Values["id"]?.ToString();

            bool controllersMatch = string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase);
            bool actionsMatch = string.Equals(currentAction, action, StringComparison.OrdinalIgnoreCase);
            bool idsMatch = id == null || string.Equals(currentId, id, StringComparison.OrdinalIgnoreCase);

            if (controllersMatch && actionsMatch && idsMatch)
            {
                return "#26A69A"; // Aktywny (Zielony)
            }
            return "#1565C0"; // Nieaktywny (Niebieski)
        }
    }

    <div class="d-flex flex-grow-1 w-100" style="min-height: 100vh;">

        <nav class="sidebar-container d-flex flex-column p-3 text-white flex-shrink-0" style="width: 275px;">

            <div class="mb-5 text-center">
                <img src="~/images/Logo.png" alt="INeed" class="img-fluid" style="max-width: 140px; margin-bottom: 10px;">
                <p class="small text-white-50" style="font-size: 0.8rem;">Bo cechuje nas profesjonalizm</p>
            </div>

            <div class="d-flex flex-column justify-content-between text-white text-center shadow-sm"
                 style="background-color: #1A2D41; min-height: 400px; border-radius: 15px; overflow: hidden;">

                <div style="height: 30px; width: 100%; background: linear-gradient(to bottom, #FFFFFF 0%, #1565C0 25%, #1565C0 100%);"></div>

                <div class="d-flex flex-column align-items-center w-100 flex-grow-1 pt-4 pb-4">
                    <div class="nav nav-pills flex-column gap-3 w-75">

                        <a class="nav-link text-white text-center shadow-sm"
                           asp-controller="Home" asp-action="Index"
                           style="background-color: @GetButtonColor("Home", "Index");">
                            Kwestionariusze
                        </a>

                        @if (_context.Forms != null)
                        {
                            var activeForms = _context.Forms.Where(f => f.IsActive).ToList();
                            foreach (var form in activeForms)
                            {
                                string actionName = (form.Title != null && form.Title.ToUpper().Contains("KOP")) ? "KOP" : "Fill";
                                string controllerName = "Questionnaire";
                                string formIdString = form.Id.ToString();

                                <a class="nav-link text-white text-center shadow-sm"
                                   asp-controller="@controllerName"
                                   asp-action="@actionName"
                                   asp-route-id="@form.Id"
                                   style="background-color: @GetButtonColor(controllerName, actionName, formIdString);">
                                    @form.Title
                                </a>
                            }
                        }

                        <a class="nav-link text-white text-center shadow-sm"
                           asp-controller="Home" asp-action="Contact"
                           style="background-color: @GetButtonColor("Home", "Contact");">
                            Kontakt
                        </a>

                    </div>
                </div>

                <div style="height: 30px; width: 100%; background: linear-gradient(to top, #FFFFFF 0%, #1565C0 25%, #1565C0 100%);"></div>
            </div>
        </nav>

        <div class="d-flex flex-column flex-grow-1 w-100">

            <header class="bg-white p-3 border-bottom d-flex justify-content-end align-items-center">
                <div class="d-flex flex-column align-items-end">
                    <div><img src="~/images/Name.png" alt="Logo INeed" style="height: 50px; width: auto; object-fit: contain;"></div>
                    <span class="mt-1" style="font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 1.875rem; line-height: 1.2; color: #1565C0;">Bo cechuje nas profesjonalizm</span>
                </div>
            </header>

            <main class="flex-grow-1 bg-white">
                <div class="container-fluid pt-4 p-4 h-100">
                    <div class="row h-100">
                        <div class="col-12">
                            <div class="d-flex flex-column justify-content-between text-white shadow-sm h-100"
                                 style="background-color: #1A2D41; min-height: 600px; border-radius: 15px; overflow: hidden;">
                                <div style="height: 30px; width: 100%; background: linear-gradient(to bottom, #FFFFFF 0%, #1565C0 25%, #1565C0 100%); flex-shrink: 0;"></div>

                                <div class="w-100 flex-grow-1 p-4" style="color: white; overflow: auto;">
                                    @RenderBody()
                                </div>

                                <div style="height: 30px; width: 100%; background: linear-gradient(to top, #FFFFFF 0%, #1565C0 25%, #1565C0 100%); flex-shrink: 0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>