@using INeed.Data
@using INeed.Helpers
@inject ApplicationDbContext _context

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData[AppConstants.Texts.Messages.Title] - @AppConstants.Texts.CompanyName</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/bootstrap_colors.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Raleway:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">

    @{
        string GetButtonColor(string controller, string action, string? id = null)
        {
            var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();
            var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
            var currentId = ViewContext.RouteData.Values["id"]?.ToString();

            if (string.Equals(currentController, controller, StringComparison.OrdinalIgnoreCase) &&
            string.Equals(currentAction, action, StringComparison.OrdinalIgnoreCase) &&
            (id == null || string.Equals(currentId, id, StringComparison.OrdinalIgnoreCase)))
            {
                return AppConstants.Colors.ActiveNav;
            }
            return AppConstants.Colors.Accent;
        }
    }

    <div class="d-flex flex-grow-1 w-100" style="min-height: 100vh;">
        <nav class="sidebar-container d-flex flex-column p-3 text-white flex-shrink-0" style="width: 275px;">
            <div class="mb-5 text-center">
                <img src="~/images/Logo.png" alt="@AppConstants.Texts.CompanyName" class="img-fluid" style="max-width: 140px; margin-bottom: 10px;">
                <p class="small text-white-50" style="font-size: 0.8rem;">@AppConstants.Texts.Slogan</p>
            </div>
            <div class="d-flex flex-column justify-content-between text-white text-center shadow-sm"
                 style="background-color: @AppConstants.Colors.Primary; min-height: 400px; border-radius: 15px; overflow: hidden;">
                <div style="height: 30px; width: 100%; background: linear-gradient(to bottom, @AppConstants.Colors.White 0%, @AppConstants.Colors.Accent 25%, @AppConstants.Colors.Accent 100%);"></div>
                <div class="d-flex flex-column align-items-center w-100 flex-grow-1 pt-4 pb-4">
                    <div class="nav nav-pills flex-column gap-3 w-75">
                        <a class="nav-link text-white text-center shadow-sm"
                           asp-controller="Home" asp-action="Index"
                           style="background-color: @GetButtonColor(AppConstants.Texts.Messages.Home, AppConstants.Texts.Messages.Index);">
                            @AppConstants.Texts.Layout.Questionnaires
                        </a>
                        @if (_context.Forms != null)
                        {
                            foreach (var form in _context.Forms.Where(f => f.IsActive).ToList())
                            {
                                <a class="nav-link text-white text-center shadow-sm"
                                   asp-controller="Questionnaire" asp-action="Fill" asp-route-id="@form.Id"
                                   style="background-color: @GetButtonColor(AppConstants.Texts.Messages.Questionnaire, AppConstants.Texts.Messages.Fill, form.Id.ToString());">
                                    @form.Title
                                </a>
                            }
                        }
                        <a class="nav-link text-white text-center shadow-sm"
                           asp-controller="Home" asp-action="Contact"
                           style="background-color: @GetButtonColor(AppConstants.Texts.Messages.Home, AppConstants.Texts.Messages.Contact);">
                            @AppConstants.Texts.Layout.Contact
                        </a>
                    </div>
                </div>
                <div style="height: 30px; width: 100%; background: linear-gradient(to top, @AppConstants.Colors.White 0%, @AppConstants.Colors.Accent 25%, @AppConstants.Colors.Accent 100%);"></div>
            </div>
        </nav>

        <div class="d-flex flex-column flex-grow-1 w-100">
            <header class="bg-white p-3 border-bottom d-flex justify-content-end align-items-center">
                <div class="d-flex flex-column align-items-end">
                    <div><img src="~/images/Name.png" alt="Logo" style="height: 50px; width: auto; object-fit: contain;"></div>
                    <span class="mt-1" style="font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 1.875rem; line-height: 1.2; color: @AppConstants.Colors.Accent;">
                        @AppConstants.Texts.Slogan
                    </span>
                </div>
            </header>
            <main class="flex-grow-1 bg-white">
                <div class="container-fluid pt-4 p-4 h-100">
                    <div class="row h-100">
                        <div class="col-12">
                            <div class="d-flex flex-column justify-content-between text-white shadow-sm h-100"
                                 style="background-color: @AppConstants.Colors.Primary; min-height: 600px; border-radius: 15px; overflow: hidden;">
                                <div style="height: 30px; width: 100%; background: linear-gradient(to bottom, @AppConstants.Colors.White 0%, @AppConstants.Colors.Accent 25%, @AppConstants.Colors.Accent 100%); flex-shrink: 0;"></div>
                                <div class="w-100 flex-grow-1 p-4" style="color: white; overflow: auto;">
                                    @RenderBody()
                                </div>
                                <div style="height: 30px; width: 100%; background: linear-gradient(to top, @AppConstants.Colors.White 0%, @AppConstants.Colors.Accent 25%, @AppConstants.Colors.Accent 100%); flex-shrink: 0;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <footer class="bg-white border-top text-muted mt-auto">
                <div class="container-fluid p-3 text-center">
                    &copy; 2026 - @AppConstants.Texts.CompanyName -
                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">
                        @INeed.Helpers.AppConstants.Texts.Layout.PrivacyPolicy
                    </a>
                    |
                    <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">
                        @INeed.Helpers.AppConstants.Texts.Layout.Terms
                    </a>
                </div>
            </footer>
        </div>
    </div>

    <div id="cookieConsentContainer" class="fixed-bottom p-4 shadow-lg"
         style="background-color: @AppConstants.Colors.Primary; border-top: 4px solid @AppConstants.Colors.ButtonSubmit; display: none; z-index: 9999;">
        <div class="container">
            <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-3">
                <div class="text-white">
                    <h5 class="fw-bold mb-1" style="color: @AppConstants.Colors.ButtonSubmit;">@AppConstants.Texts.Layout.CookieHeader</h5>
                    <p class="mb-0 small opacity-75">
                        @AppConstants.Texts.Layout.CookieBody
                        <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal" class="text-white text-decoration-underline">@AppConstants.Texts.Layout.PrivacyPolicy</a>.
                    </p>
                </div>
                <div class="d-flex gap-2 flex-shrink-0">
                    <button id="acceptCookies" class="btn fw-bold px-4 py-2 shadow-sm"
                            style="background-color: @AppConstants.Colors.ButtonSubmit; color: #000; border-radius: 25px;">
                        @AppConstants.Texts.Layout.CookieButton
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (!localStorage.getItem("cookieConsent")) {
                setTimeout(function() { document.getElementById("cookieConsentContainer").style.display = "block"; }, 500);
            }
            document.getElementById("acceptCookies").addEventListener("click", function () {
                localStorage.setItem("cookieConsent", "true");
                document.getElementById("cookieConsentContainer").style.display = "none";
            });
        });
    </script>

    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">@INeed.Helpers.AppConstants.Texts.Layout.PrivacyPolicy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
                </div>
                <div class="modal-body text-dark" style="text-align: left;">
                    @Html.Raw(INeed.Helpers.AppConstants.Texts.PolicyContent.PrivacyAndCookies)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">@INeed.Helpers.AppConstants.Texts.Layout.Terms</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
                </div>
                <div class="modal-body text-dark" style="text-align: left;">
                    @Html.Raw(INeed.Helpers.AppConstants.Texts.PolicyContent.Terms)
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>